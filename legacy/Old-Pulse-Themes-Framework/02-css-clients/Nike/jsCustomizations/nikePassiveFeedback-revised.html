<style>
  #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(9), #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(10), #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(11), #_pi_surveyWidget > div._pi_widgetContentContainer > ul:nth-child(12), #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(13), #_pi_surveyWidgetContainer.mobile-enabled #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(9), #_pi_surveyWidgetContainer.mobile-enabled #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(10), #_pi_surveyWidgetContainer.mobile-enabled #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(11), #_pi_surveyWidgetContainer.mobile-enabled #_pi_surveyWidget > div._pi_widgetContentContainer > ul:nth-child(12), #_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(13){
    display: none !important;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container {
    position: relative;
    overflow: visible;
    /* Style the arrow inside the select element: */
    /* Point the arrow upwards when the select box is open (active): */
    /* style the items (options), including the selected item: */
    /* Style items (options): */
    /* Hide the items when the select box is closed: */
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container select._pi_select {
    display: none;
    /*hide original SELECT element: */
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-selected {
    background-color: DodgerBlue;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-selected:after {
    position: absolute;
    content: "";
    top: 14px;
    right: 10px;
    width: 0;
    height: 0;
    border: 6px solid transparent;
    border-color: #fff transparent transparent transparent;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-selected.select-arrow-active:after {
    border-color: transparent transparent #fff transparent;
    top: 7px;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-items div, div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-selected {
    color: #ffffff;
    padding: 8px 16px;
    border: 1px solid transparent;
    border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
    cursor: pointer;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-items {
    position: absolute;
    background-color: DodgerBlue;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 99;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-hide {
    display: none;
  }

  div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .select-items div:hover, div#_pi_surveyWidgetContainer.all-at-once ._pi_answers_container .same-as-selected {
    background-color: rgba(0, 0, 0, 0.1);
  }

</style>



<script>
  // var list = PulseInsightsObject.survey.questions;
  // var question = {};
  // var answers = [];
  // for (var i = 0; i < list.length; i++) {
  //   question = list[i];
  //   //is a menu
  //   if(question.question_type == "single_choice_question" && question.button_type == 2){
  //     answers = question.possible_answers;
  //     for (var j = 0; j < answers; j++) {
  //       if(answers[j].next_question_id !== null){
  //         //bind the events
  //       }
  //     }
  //   }
  // }

  var conditionalConfig = [
      {
        'id': 8961,
        'answers': {
          25673 : [8964, 8962],
          25675 : [8964, 8962]
        }
      },
      {
        'id': 8964,
        'answers':{
          25685 : [8965],
          25686 : [8965]
        }
      }
  ];

  Array.prototype.unique = function() {
    var a = this.concat();
    for(var i=0; i<a.length; ++i) {
        for(var j=i+1; j<a.length; ++j) {
            if(a[i] === a[j])
                a.splice(j--, 1);
        }
    }

    return a;
  };

  function Question(args){
    this.id = args.id;
    this.answers = args.answers;
    this.question = this.getPulseQuestion(this.id);
    this.dependents = this.getDependents();
    this.dependentQuestions = this.getSubUnits;
    this.subUnits = this.getSubUnits();
    this.attachEvents();
  }
  Question.prototype.getSubUnits = function(){
    var getPreviousSibling = function (elem, className) {

    	// Get the next sibling element
    	var sibling = elem.previousElementSibling;

    	// If there's no className, return the first sibling
    	if (!className) return sibling;

    	// If the sibling matches our className, use it
    	// If not, jump to the next sibling and continue the loop
    	while (sibling) {
    		if (sibling.classList.contains(className)) return sibling;
    		sibling = sibling.previousElementSibling;
    	}

    };
    var getNextSibling = function (elem, className) {

    	// Get the next sibling element
    	var sibling = elem.nextElementSibling;

    	// If the sibling matches our className, use it
    	// If not, jump to the next sibling and continue the loop
    	while (sibling) {
    		if (sibling.classList.contains(className)) return sibling;
    		sibling = sibling.nextElementSibling
    	}

    };
    dependentQuestions = [];
    for (var i = 0; i < this.dependents.length; i++) {
      //get question el
      dependentQuestions[i] = this.getPulseQuestion(this.dependents[i]);
      baseEl = PulseInsightsObject.survey.widgetContainer.querySelector('._pi_answers_container[data-question-id="'+ dependentQuestions[i].id +'"]');

      // if(optional == "f"){
        //need to handle optional stuff
      // }
      if(dependentQuestions[i].after_answers_count != "0" && dependentQuestions[i].after_answers_items != null){
        // get after answer el
        dependentQuestions[i].afterAnswers = getNextSibling(baseEl, '_pi_scale_container_after');
      }
      if(dependentQuestions[i].before_answers_count != "0" && dependentQuestions[i].before_answers_items != null){
        // get before answer el
        dependentQuestions[i].afterAnswers = getNextSibling(baseEl, '_pi_scale_container_before');
      }
      if(dependentQuestions[i].before_question_text != ""){
        // get before question el
        dependentQuestions[i].afterAnswers = getNextSibling(baseEl, 'pi_header_before');
      }
      if(dependentQuestions[i].after_question_text != ""){
        // get after question el
        dependentQuestions[i].afterAnswers = getNextSibling(baseEl, 'pi_header_after');
      }
      // id: 8961
    }
    return dependentQuestions;
  }
  Question.prototype.attachEvents = function(){
    // single choice
    if(this.question.question_type == "single_choice_question"){
      // normal single choice

      if(this.question.button_type === 0 || this.question.button_type === 1){
        var els = document.querySelectorAll('._pi_answers_container[data-question-id="'+ this.question.id +'"] li a');
        for (var i = 0; i < els.length; i++) {
          // el = document.querySelector('[data-answer-id="' + this.answers[i].id + '"]');
          var elId = els[i].getAttribute('data-answer-id');
          if(typeof this.answers[elId] != 'undefined'){
            els[i].addEventListener('click', this.showQuestions(elId)).bind(this);
          }
          else{
            els[i].addEventListener('click', this.hideQuestions()).bind(this);
          }
        }
      }
      // select input
      else if(this.question.button_type === 2){
        var el = document.querySelector('._pi_answers_container[data-question-id="'+ this.question.id +'"] select._pi_select');

        el.addEventListener('change', function(e){
          if(typeof this.answers[el.value] != 'undefined'){
            this.showQuestions(this.answers[el.value]);
          }
          else{
            this.hideQuestions();
          }
        }.bind(this));
      }
    }
    // multiple choice
    else if(this.question.question_type == "multiple_choices_question"){
      var parentEl = document.querySelector('._pi_answers_container[data-question-id="'+ this.question.id +'"]'),
          els = parentEl.querySelectorAll('li label');
      for (var i = 0; i < els.length; i++) {
        els[i].addEventListener('click', function(e){
          for (var j = 0; j < this.answers.length; j++) {
            if(parentEl.getAttribute('data-answer').indexOf(this.answers[j]) !== -1){
              this.showQuestions();
            }
            else{
              this.hideQuestions();
            }
          }
        }).bind(this);
      }
    }
  }
  Question.prototype.getPulseQuestion = function(id){
    for (var i = 0; i < PulseInsightsObject.survey.questions.length; i++) {
      if(PulseInsightsObject.survey.questions[i].id === id){
        return PulseInsightsObject.survey.questions[i];
      }
    }
  }
  Question.prototype.getDependents = function(){
    var dependents = [],
        keys = Object.keys(this.answers);
    for (var i = 0; i < keys.length; i++) {
      dependents = dependents.concat(this.answers[keys[i]]).unique();
    }
    return dependents;
  }
  Question.prototype.showQuestions = function(answer){
    //check and see if its already shown
    console.log('show');
    console.log(answer);

    //determine if there are subelements and show them
    // if(){
    //
    // }
    // else if(){
    //
    // }
  }
  Question.prototype.hideQuestions = function(){
    console.log('hide');
    console.log(this.dependents);
    //check and see if its already hidden

    //determine if there are subelements and hide them


  }

  for (var i = 0; i < conditionalConfig.length; i++) {
    new Question(conditionalConfig[i]);
  }


  setTimeout(function(){

    var select = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(4) > select");
    var selectTargetQuestion1 = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(9)");
    var selectTargetInput1 = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(10)");
    var selectTargetQuestion2 = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(11)");
    var selectTargetInput2 = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > ul:nth-child(12)");
    var scaleContainer = PulseInsightsObject.survey.widgetContent.querySelector("#_pi_surveyWidget > div._pi_widgetContentContainer > div:nth-child(13)");
    select.addEventListener("change", function(e){
      if(this.value == 25673 || this.value == 25675){
        selectTargetInput1.style.setProperty("display", "flex", "important");
        selectTargetInput1.setAttribute("data-question-optional", "f");
        selectTargetQuestion1.style.setProperty("display", "block", "important");

        selectTargetInput2.style.setProperty("display", "flex", "important");
        selectTargetInput2.setAttribute("data-question-optional", "f");
        selectTargetQuestion2.style.setProperty("display", "block", "important");

        scaleContainer.style.setProperty("display", "flex", "important");
      }
      else{
        selectTargetInput1.style.setProperty("display", "none", "important");
        selectTargetInput1.setAttribute("data-question-optional", "t");
        selectTargetInput1.removeAttribute("data-answer");
        selectTargetInput1.querySelector("select").value="";
        selectTargetQuestion1.style.setProperty("display", "none", "important");

        selectTargetInput2.style.setProperty("display", "none", "important");
        selectTargetInput2.setAttribute("data-question-optional", "t");
        selectTargetInput2.removeAttribute("data-answer");
        selectTargetInput2.removeAttribute("data-answer-content");
        var selected = selectTargetInput2.querySelector(".selected");
        if(selected != null){
          selected.removeAttribute("class");
        }
        selectTargetQuestion2.style.setProperty("display", "none", "important");

        scaleContainer.style.setProperty("display", "none", "important");
      }
    });
  }, 500);

 var x, i, j, l, ll, selElmnt, a, b, c;
/* Look for any elements with the class "custom-select": */
x = document.getElementsByClassName("_pi_select");
var parents = [];
l = x.length;
for (i = 0; i < l; i++) {
  parents[i] = x[i].parentNode;
  selElmnt = parents[i].getElementsByTagName("select")[0];
  ll = selElmnt.length;
  /* For each element, create a new DIV that will act as the selected item: */
  a = document.createElement("DIV");
  a.setAttribute("class", "select-selected");
  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
  parents[i].appendChild(a);
  /* For each element, create a new DIV that will contain the option list: */
  b = document.createElement("DIV");
  b.setAttribute("class", "select-items select-hide");
  for (j = 1; j < ll; j++) {
    /* For each option in the original select element,
    create a new DIV that will act as an option item: */
    c = document.createElement("DIV");
    c.innerHTML = selElmnt.options[j].innerHTML;
    c.addEventListener("click", function(e) {
      console.log('c clicked');
        /* When an item is clicked, update the original select box,
        and the selected item: */
        var y, i, k, s, h, sl, yl;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        sl = s.length;
        h = this.parentNode.previousSibling;
        for (i = 0; i < sl; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            yl = y.length;
            for (k = 0; k < yl; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        s.dispatchEvent(new Event('change', { 'bubbles': true }));
        h.click();
    });
    b.appendChild(c);
  }
  parents[i].appendChild(b);
  a.addEventListener("click", function(e) {
    console.log('a clicked');
    /* When the select box is clicked, close any other select boxes,
    and open/close the current select box: */
    e.stopPropagation();
    closeAllSelect(this);
    this.nextSibling.classList.toggle("select-hide");
    this.classList.toggle("select-arrow-active");
  });
}

function closeAllSelect(elmnt) {
  console.log('close actuated');
  /* A function that will close all select boxes in the document,
  except the current select box: */
  var x, y, i, xl, yl, arrNo = [];
  x = document.getElementsByClassName("select-items");
  y = document.getElementsByClassName("select-selected");
  xl = x.length;
  yl = y.length;
  for (i = 0; i < yl; i++) {
    if (elmnt == y[i]) {
      arrNo.push(i)
    } else {
      y[i].classList.remove("select-arrow-active");
    }
  }
  for (i = 0; i < xl; i++) {
    if (arrNo.indexOf(i)) {
      x[i].classList.add("select-hide");
    }
  }
}

/* If the user clicks anywhere outside the select box,
then close all select boxes: */
document.querySelector('#_pi_surveyWidgetContainer').addEventListener("click", closeAllSelect);
</script>
