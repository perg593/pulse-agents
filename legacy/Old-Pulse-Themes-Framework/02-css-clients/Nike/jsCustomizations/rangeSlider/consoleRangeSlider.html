<script>
var parentEl = document.querySelector("div[data-question-id='11469']");
var topContainer = document.createElement("div");
topContainer.setAttribute("id", "topContainer");
var sliderContainer =  document.createElement("div");
sliderContainer.setAttribute("id", "sliderContainer");
topContainer.appendChild(sliderContainer);
parentEl.appendChild(topContainer);



var isInit = true;

var labelEls;
var updateActiveLabel = function(values, handle, unencoded, tap, positions, noUiSlider){
  var index = parseInt(values[0]);
  for (var i = 0; i < labelEls.length; i++) {
    if(index === i){
      labelEls[i].classList.add("active");
    }
    else{
      labelEls[i].classList.remove("active");
    }

  }
}

var interacted = false;
var setInteracted = function(){
  console.log("Set interacted");
  var bar = document.querySelector(".noUi-base .noUi-connects");
  if(!bar.classList.contains("interacted")){
    bar.classList.add("interacted");
  }
  interacted = true;
}

var selectInput = parentEl.querySelector("select"),
    options = selectInput.querySelectorAll("option");



var changed;
if(typeof Event === "function") {
  changed =  new Event("change");
}
else{
  changed = document.createEvent("Event");
  changed.initEvent("change", true, true);
}



var updateSelect = function(values, handle, unencoded, tap, positions, noUiSlider){
 var index = parseInt(values[0]);
 selectInput.selectedIndex = index + 1;
 selectInput.dispatchEvent(changed);
}

var html5Slider = document.getElementById('sliderContainer');

var labels = {
    0: 'Not at all easy',
    1: 'Not very easy',
    2: 'Somewhat easy',
    3: 'Pretty easy',
    4: 'Extremely easy',
};

function renameLabels (value) {
    return labels[value];
}

var formatter = {
    to: renameLabels
}
var range_all_sliders = {
	'min': [0],
	'max': [4]
};
function filterPips(value, type) {
    if (type === 0) {
        return -1;
    }
    return 1;
}
var slider = noUiSlider.create(html5Slider, {
    start: [2],
    connect: false,
		step: 1,
    connect: "upper",
    range: range_all_sliders,
		pips: {mode: 'steps', format: formatter, filter: filterPips},
});

html5Slider.noUiSlider.on("update", function(values, handle, unencoded, tap, positions, noUiSlider){
  if(isInit){
    labelEls = parentEl.querySelectorAll(".noUi-pips .noUi-value");
    isInit = false;
  }
  else{
    updateSelect(values, handle, unencoded, tap, positions, noUiSlider);
    updateActiveLabel(values, handle, unencoded, tap, positions, noUiSlider);
    setInteracted();
  }
  console.log(values);
  console.log(labelEls);

});

var ctrlPips = document.querySelectorAll(".noUi-marker.noUi-marker-horizontal.noUi-marker-large");
for (var i = 0; i < ctrlPips.length; i++) {
  ctrlPips[i].setAttribute("data-goto", i);
  ctrlPips[i].addEventListener("click", function(e){
    html5Slider.noUiSlider.set(this.getAttribute("data-goto"));
  });
}

document.querySelector(".noUi-handle.noUi-handle-lower").addEventListener("click", function(e){
  if(!interacted){
    html5Slider.noUiSlider.set(html5Slider.noUiSlider.get());
  }
});

</script>
