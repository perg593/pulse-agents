window.getSurveyObj = function(){
  return PulseInsightsObject.survey;
}

if (!Array.prototype.includes) {
  Object.defineProperty(Array.prototype, 'includes', {
    value: function (searchElement, fromIndex) {

      if (this == null) {
        throw new TypeError('"this" is null or not defined');
      }

      // 1. Let O be ? ToObject(this value).
      var o = Object(this);

      // 2. Let len be ? ToLength(? Get(O, "length")).
      var len = o.length >>> 0;

      // 3. If len is 0, return false.
      if (len === 0) {
        return false;
      }

      // 4. Let n be ? ToInteger(fromIndex).
      //    (If fromIndex is undefined, this step produces the value 0.)
      var n = fromIndex | 0;

      // 5. If n ≥ 0, then
      //  a. Let k be n.
      // 6. Else n < 0,
      //  a. Let k be len + n.
      //  b. If k < 0, let k be 0.
      var k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);

      function sameValueZero(x, y) {
        return x === y || (typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y));
      }

      // 7. Repeat, while k < len
      while (k < len) {
        // a. Let elementK be the result of ? Get(O, ! ToString(k)).
        // b. If SameValueZero(searchElement, elementK) is true, return true.
        if (sameValueZero(o[k], searchElement)) {
          return true;
        }
        // c. Increase k by 1.
        k++;
      }

      // 8. Return false
      return false;
    }
  });
}

if (window.optimizely != undefined && optimizely.get('state').getVariationMap() != null) {
 console.log('Pulse Insights: Optimizely exists. Collecting variation and experiment IDs.');
 var variation = optimizely.get('state').getVariationMap();
 var variation_IDs = []; // initialize empty array.
 var experiment_IDs = optimizely.get('state').getActiveExperimentIds();
 for (v = 0; v < experiment_IDs.length; v++) {
  variation_IDs.push(variation[experiment_IDs[v]].id);
 }
 console.log(experiment_IDs);
 console.log(variation_IDs);
 // set context data.
 //pi('set_context_data', {experimentIDs: experiment_IDs, variationIDs: variation_IDs});
}

/*
// ------------------ VISA NAV 3151 CLICK TEST ------------------
currentInlineTarget = null;
//var exp_ID = optimizely.get('state').getVariationMap()[Object.keys(optimizely.get('state').getVariationMap())[0]].id;
var survey_answered = false;
//var variation = optimizely.get('state').getVariationMap();
//var variation_IDs = []; // initialize empty array.
//var experiment_IDs = optimizely.get('state').getActiveExperimentIds();
//for (v = 0; v < experiment_IDs.length; v++) {
//  variation_IDs.push(variation[experiment_IDs[v]].id);
//}

function display(inline_target, custom_data, survey_answered) {
  if (inline_target === currentInlineTarget) { return; }
  currentInlineTarget = inline_target;
  if (pi_nav != null) {
    pi_nav.destroy();
    pi_nav.attributes.inline_target_selector = inline_target;
    //pi('set_context_data', {tab: custom_data, experimentIDs: experiment_IDs, variationIDs: variation_IDs});
    pi_nav.render();
  }
}

nav_attr = window.PulseInsightsObject.survey.attributes.id;

if (nav_attr == 3151) {
  pi_nav = window.PulseInsightsObject.survey;


  var delayInMilliseconds = 1000; //1 second

  setTimeout(function () {
    if (pi_nav != undefined) {
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(2) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(2) > div", "Find a Card", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(4) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(4) > div", "Contactless Payments", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(5) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(5) > div", "Pay With Visa - Payment Technology", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(2) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(2) > div", "Partner With Us - Payment Technology", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(4) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(4) > div", "Info for Partners", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(5) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(5) > div", "Visa Consulting and Analytics", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(2) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(2) > div", "Small Busines Tools", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(3) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(3) > div", "Commercial Solutions", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(2) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(2) > div", "Visa Innovations", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(5) > a").onclick = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(5) > div", "About Visa", survey_answered) };
    }
  }, delayInMilliseconds);

  setTimeout(function () {
    if (pi_nav != undefined) {
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(2) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(2) > div", "Find a Card", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(4) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(4) > div", "Contactless Payments", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(5) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(1) > ul > li:nth-child(5) > div", "Pay With Visa - Payment Technology", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(2) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(2) > div", "Partner With Us - Payment Technology", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(4) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(4) > div", "Info for Partners", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(5) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(2) > ul > li:nth-child(5) > div", "Visa Consulting and Analytics", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(2) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(2) > div", "Small Busines Tools", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(3) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(3) > ul > li:nth-child(3) > div", "Commercial Solutions", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(2) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(2) > div", "Visa Innovations", survey_answered) };
      document.querySelector("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(5) > a").onmouseenter = function () { display("#vs-navigation-nav > div.vs-container-fluid.vs-header-container > ul > li:nth-child(5) > ul > li:nth-child(5) > div", "About Visa", survey_answered) };
    }
  }, delayInMilliseconds);

}
*/

/* FREE-TEXT JAVASCRIPT VALIDATIONS */

// ---------------- validations -----------------
function validateSSN (elementValue) {
  var  ssnPattern = /[0-9]{3}\-?[0-9]{2}\-?[0-9]{4}/;
  return ssnPattern.test(elementValue);
}

function validatePN (elementValue) {
  var pnPattern = /[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}/im;
  return pnPattern.test(elementValue);
}

function validateEmail (elementValue) {
  //var emailPattern = /(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/;
  var emailPattern = /[\@]/;
  return emailPattern.test(elementValue);
}

function atLeastFive (elementValue) {
  var atLeastFivePattern = /(?=(\D*\d){5,}\D*)/;
  return atLeastFivePattern.test(elementValue);
}


function validateEntry() {
  var input = document.getElementsByClassName('_pi_free_text_question_field')[0].value;
  if (validateSSN(input)) {
    //pulseinsights('set_device_data', {rejectedSSN:'yes'});
    alert('Oops, looks like you are trying to submit personal information!');
  } else if (validatePN(input)) {
    //pulseinsights('set_device_data', {rejectedPhone:'yes'});
    alert('Oops, looks like you are trying to submit personal information!');
  } else if (validateEmail(input)) {
    //pulseinsights('set_device_data', {rejectedEmail:'yes'});
    alert('Oops, looks like you are trying to submit personal information!');
  } else if (atLeastFive(input)) {
    //pulseinsights('set_device_data', {rejectedOther:'yes'});
    alert('Oops, looks like you are trying to submit personal information!');
  } else {
    //pulseinsights('set_device_data', {validated:'yes'});
    window.PulseInsightsObject.survey.freeTextSubmitClicked();
  }
}

var interval = setInterval(function() {
  var submit_button = document.getElementsByClassName('_pi_free_text_question_submit_button')[0];
  if (typeof submit_button == 'undefined') return;
  clearInterval(interval);
  submit_button.onclick = function() { validateEntry() };
}, 10);

//content square impression
if (window.CS_CONF && CS_CONF.integrations_handler && CS_CONF.integrations_handler.pulseinsights) {
    CS_CONF.integrations_handler.pulseinsights("display");
}


if(PulseInsightsObject.survey.attributes.survey_locale_group_id === "286" || PulseInsightsObject.survey.attributes.survey_locale_group_id === "411"){

console.log("hi");
  window.survey_id = window.PulseInsightsObject.survey.attributes.id;
  window.submitLangMap = {
    "en" : "Submit",
    "es" : "Enviar",
    "pt" : "Enviar",
    "fr" : "Soumettre",
    "zh-simple" : "提交",
    "zh" : "提交",
    "ja" : "投稿する",
    "ru" : "Отправить",
    "de" : "Einreichen"
  };
  window.surveyMap = {
    4723 : "en", //us
    4733 : "es", //argentina
    4734 : "pt", //brazil
    4735 : "fr", //canada fr
    4736 : "en", //ca en
    4737 : "en", //aus en
    4738 : "ja", //japan
    4739 : "ru", //rusia
    4740 : "en", //uk
    4741 : "es", //mexico
    4742 : "de", //de
    4743 : "zh-simple", // china simple
    4744 : "zh", // taiwan traditional
    4746 : "zh", // HK traditional
    4747 : "en", //HK en
    4255 : "en", //us - b2b
    4806 : "es", //argentina - b2b
    4807 : "fr", //canada french - b2b
    4808 : "en", //ca en - b2b
    4809 : "en", //aus en - b2b
    4810 : "ja", //japan - b2b
    4811 : "ru", //russia - b2b
    4812 : "en", //uk - b2b
    4813 : "es", //mexico - b2b
    4814 : "de", //de - b2b
    4815 : "zh-simple", //china simple - b2b
    4816 : "zh", //taiwan traditional - b2b
    4817 : "zh", //HK traditional - b2b
    4818 : "en", //HK en - b2b
    4821 : "pt" //brazil - b2b
  };
  window.PulseInsightsObject.survey.renderMultipleChoicesQuestion = function(possibleAnswersContainer, display_all_questions) {
            var fn, i, is_mobile, len, ref, self, submitButton, submitButtonContainer, textInputContainer;
            for (this.checkBoxes = [],
            self = this,
            is_mobile = window.PulseInsightsObject.isMobile() && 1 !== this.attributes.survey_type && 3 !== this.attributes.survey_type,
            fn = function(possibleAnswer) {
                var checkBox, checkBoxControl, per_row, possibleAnswerElement, possibleAnswerLabelElement;
                if ((possibleAnswerElement = document.createElement("li")).setAttribute("data-possible-answer-locale-group-id", possibleAnswer.possible_answer_locale_group_id),
                (checkBox = document.createElement("input")).setAttribute("class", "_pi_checkbox"),
                checkBox.setAttribute("type", "checkbox"),
                checkBox.setAttribute("value", possibleAnswer.id),
                (checkBoxControl = document.createElement("div")).setAttribute("class", "_pi-control-indicator"),
                (possibleAnswerLabelElement = document.createElement("label")).setAttribute("class", "_pi-control _pi-control-checkbox"),
                possibleAnswerLabelElement.innerHTML = window.PulseInsightsObject.survey.formatText(possibleAnswer.content),
                possibleAnswerLabelElement.insertBefore(checkBoxControl, possibleAnswerLabelElement.firstChild),
                possibleAnswerLabelElement.insertBefore(checkBox, possibleAnswerLabelElement.firstChild),
                checkBox.onclick = window.PulseInsightsObject.survey.multipleChoicesCheckboxClicked,
                possibleAnswerElement.appendChild(possibleAnswerLabelElement),
                possibleAnswersContainer.appendChild(possibleAnswerElement),
                per_row = is_mobile ? self.question.answers_per_row_mobile : self.question.answers_per_row_desktop)
                    return possibleAnswerElement.setAttribute("style", "max-width: calc(" + 100 / per_row + "% - 20px);")
            }
            ,
            i = 0,
            len = (ref = this.question.possible_answers).length; i < len; i++)
                fn(ref[i]);
            this.question.submit_label = window.submitLangMap[window.surveyMap[window.survey_id]];
            return (textInputContainer = document.createElement("div")).setAttribute("class", "_pi_free_text_question_field_container"),
            this.choicesCountLabel = document.createElement("div"),
            this.choicesCountLabel.setAttribute("class", "_pi_multiple_choices_count"),
            possibleAnswersContainer.appendChild(textInputContainer),
            textInputContainer.appendChild(this.choicesCountLabel),
            submitButtonContainer = document.createElement("div"),
            display_all_questions || (submitButtonContainer.setAttribute("class", "_pi_multiple_choices_question_submit_button_container"),
            (submitButton = document.createElement("input")).setAttribute("class", "_pi_multiple_choices_question_submit_button"),
            submitButton.setAttribute("type", "submit"),
            submitButton.setAttribute("value", this.question.submit_label || "Submit"),
            submitButton.onclick = window.PulseInsightsObject.survey.multipleChoicesSubmitClicked,
            submitButtonContainer.appendChild(submitButton)),
            possibleAnswersContainer.appendChild(submitButtonContainer)
        }


  PulseInsightsObject.survey.multipleChoicesCheckboxClicked = function(event) {

      var answerContainer, charactersCountLabelTextNode, checkBoxes, choicesCountLabel, choicesLabelText, i, index, len, maximumSelection, question, questionId, ref, survey;
      var langMap = {
        "en" : "Maximum of 3 please",
        "es" : "Máximo de 3 por favor",
        "pt" : "Máximo de 3 por favor",
        "fr" : "Maximum de 3 s'il vous plaît",
        "zh-simple" : "最多3个",
        "zh" : "最多3個",
        "ja" : "最大3つまでお願いします",
        "ru" : "Максимум 3, пожалуйста",
        "de" : "Maximal 3 bitte"
      };

      if (event.stopPropagation(),
      checkBoxes = (survey = window.PulseInsightsObject.survey).checkBoxes,
      choicesCountLabel = survey.choicesCountLabel,
      answerContainer = this.parentNode.parentNode.parentNode,
      "t" === survey.attributes.display_all_questions)
          for (questionId = parseInt(answerContainer.getAttribute("data-question-id")),
          i = 0,
          len = (ref = survey.questions).length; i < len; i++)
              (question = ref[i]).id === questionId && null != question.maximum_selection && (maximumSelection = question.maximum_selection);
      else
          null != survey.question.maximum_selection && (maximumSelection = survey.question.maximum_selection);
      if (this.checked ? (survey.checkBoxes.push(this.value),
      null != maximumSelection && checkBoxes.length > maximumSelection && (choicesLabelText = langMap[window.surveyMap[window.survey_id]],
      charactersCountLabelTextNode = document.createTextNode(choicesLabelText),
      choicesCountLabel.innerHTML = "",
      choicesCountLabel.appendChild(charactersCountLabelTextNode))) : (index = survey.checkBoxes.indexOf(this.value),
      survey.checkBoxes.splice(index, 1),
      null != maximumSelection && checkBoxes.length <= maximumSelection && (choicesLabelText = "",
      charactersCountLabelTextNode = document.createTextNode(choicesLabelText),
      choicesCountLabel.innerHTML = "",
      choicesCountLabel.appendChild(charactersCountLabelTextNode))),
      null != maximumSelection && checkBoxes.length > maximumSelection ? answerContainer.setAttribute("data-answer", "") : answerContainer.setAttribute("data-answer", survey.checkBoxes),
      "t" === survey.attributes.display_all_questions)
          return survey.checkSubmissionCompleteness(answerContainer)
  }
}
