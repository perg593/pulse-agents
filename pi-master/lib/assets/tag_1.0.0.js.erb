<%
  # legacy_tag.js is an old version of tag.js.erb which came to be replaced in https://gitlab.ekohe.com/ekohe/pulseinsights/pi/-/issues/2645
  # Bindings:
  #   @survey_js_host        - the domain name that hosts surveys.js (Required)
  #   @survey_host           - the domain name that returns surveys (Required)
  #   @identifier            - account identifier (Required)
  #   @debug_mode            - runs surveys.js in the debug mode (Optional)
  #   @use_new_spa_behaviour - enables the new behaviour where the browser history is updated before displaying a survey (optional)
  #   @present_results       - switches the presentation from a survey to results (Optional)
  #   @submission_udid       - determines which results to show (Optional)
%>
(function() {
  var w = window, d = document;
  w['pi']=function() {
    w['pi'].commands = w['pi'].commands || [];
    w['pi'].commands.push(arguments);
  };

  var s = d.createElement('script'); s.async = 1;
  s.src = '<%= @survey_js_host %>/surveys.js';

  var f = d.getElementsByTagName('script')[0];
  f.parentNode.insertBefore(s, f);
  <%= "pi('debug', true);" if @debug_mode %>
  pi('host', '<%= @survey_host %>');
  pi('identify', '<%= @identifier %>');
  <%= "pi('pushBeforeGet', true);" if @use_new_spa_behaviour %>
  <%= @present_results ? "pi('present_results', '#{@submission_udid}')" : "pi('get', 'surveys');" %>
})();
