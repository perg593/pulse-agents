# frozen_string_literal: true
# rubocop:disable Layout/LineLength
# rubocop:disable Layout/SpaceBeforeComma
# rubocop:disable Layout/SpaceAfterComma
# rubocop:disable Style/RedundantInterpolation

xlsx_package.use_shared_strings = true
wb = xlsx_package.workbook
wb.add_worksheet(name: "Accounts") do |sheet|
  wrap = wb.styles.add_style alignment: { horizontal: :left, vertical: :center ,wrap_text: true }

  header = ['Account', 'Surveys', 'Server Calls', 'Impressions', 'Submissions', 'Last Login', 'Join Date', 'Logins']
  !user_list? && header.push('Users')
  sheet.add_row header, sz: 12, b: true, fg_color: '0000FF'

  @objects.each do |object|
    name = user_list? ? infos_for_user(object) : infos_for_account(object)
    name.sub!("<br />", "\n")
    content = ["#{name}", object.surveys.size, object.calls_count, object.impressions.size, object.submissions.size, object.last_sign_in_at.to_s, object.join_date.to_s, object.sign_in_count]
    !user_list? && content.push(object.users.size)

    sheet.add_row content, style: wrap
  end
end
