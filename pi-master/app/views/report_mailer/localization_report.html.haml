%div{ style: 'background-color: #ffffff' }
  = render 'header'
  = render 'survey_stats'

  - @reportee.base_questions.each do |base_question|
    .question{ style: 'margin: 30px 20px;'}
      .content-responses-count{ style: 'padding: 10px 0;'}
        .content{ style: 'font-size: 18px;'}= base_question.content

      .answers{ style: 'border: 1px solid #E3E3E3;' }
        .responses-count{ style: 'float: right; font-size: 12px; color: #767676; padding: 10px;'}
          :ruby
            reportee_questions = base_question.question_locale_group.questions.where(survey_id: @reportee_survey_ids)
            answers = Answer.where(question: reportee_questions)
            answers = answers.where(created_at: @date_range) if @date_range
            question_answer_count = answers.select(:submission_id).distinct(:submission_id).count

          = pluralize(number_with_delimiter(question_answer_count), "Response")

        - if base_question.question_type == 'free_text_question'
          - answers = answers.limit(100)
          - if answers.count == 100
            .last-hundred-responses{ style: 'font-size: 12px; color: #767676; margin: 20px;' } Latest 100 responses
          - answers.each do |answer|
            .answer-content{ style: 'margin: 20px' }= answer.text_answer
        - else
          - base_question.possible_answers.each do |possible_answer|
            :ruby
              reportee_possible_answers = possible_answer.possible_answer_locale_group.possible_answers.where(question: reportee_questions)
              answers = Answer.where(possible_answer: reportee_possible_answers)
              answers = answers.where(created_at: @date_range) if @date_range
              answer_rate = answers.count.zero? ? '0%' : number_to_percentage(answers.count * 100 / question_answer_count.to_f, precision: 0)
              width = [answer_rate.to_i, 0.1].max

            .answer{ style: 'margin: 40px 0;' }
              .answer-content{ style: 'color: #767676; margin-left: 10px; margin-bottom: 5px;'}= possible_answer.content
              .progress-custom{ style: 'height: 50px;'}
                %table{style: "width: 100%"}
                  %tr{style: "width: 100%; height: 50px;"}
                    %td{style: "width: #{width}%; background-color: #6086C1; box-shadow: none; border-bottom-right-radius:4px; border-top-right-radius: 4px; color: #FFFFFF; padding: 3px 10px 3px 10px; text-align: right; min-width: max-content; vertical-align: middle", valign: 'middle'}
                      = number_with_delimiter(answers.count)
                    %td{ style: "color: #5B5B5B; padding: 3px 3px 3px 10px; vertical-align: middle", valign: 'middle'}
                      = answer_rate

  / TODO: move these vars to mailer
  - report_page_url = @from && @to ? report_jobs_url(survey_locale_group_id: @reportee.id, from: @from.strftime('%Y-%m-%d'), to: @to.strftime('%Y-%m-%d')) : report_jobs_url(survey_locale_group_id: @reportee.id)
  - scheduled_report_page_url = @scheduled_report_id ? edit_scheduled_report_url(@scheduled_report_id) : nil

  = render 'report_links', report_page_url: report_page_url, report_url: @report_url, report_csv_url: @report_csv_url, scheduled_report_page_url: scheduled_report_page_url
  = render 'footer'
