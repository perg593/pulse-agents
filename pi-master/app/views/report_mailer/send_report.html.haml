%div{ style: 'background-color: #ffffff' }
  = render 'header'
  = render 'survey_stats'

  - @reportee.questions.sort_by_position.each do |question|
    - possible_answer_rates = question.answer_rates(filters: @filters)
    .question{ style: 'margin: 30px 20px;'}
      .content-responses-count{ style: 'padding: 10px 0;'}
        .content{ style: 'font-size: 18px;'}= question.content

      .answers{ style: 'border: 1px solid #E3E3E3;' }
        .responses-count{ style: 'float: right; font-size: 12px; color: #767676; padding: 10px;'}
          = pluralize(number_with_delimiter(question.answers_count(:group_submission_id, filters: @filters)), 'Response')

        - if question.question_type == 'free_text_question'
          - answers = Answer.filtered_answers(question.answers, filters: @filters)

          - if answers.count > 100
            .last-hundred-responses{ style: 'font-size: 12px; color: #767676; margin: 20px;' } Latest 100 responses
          - answers.last(100).each do |answer|
            .answer-content{ style: 'margin: 20px' }= answer.text_answer
        - else
          - possible_answer_rates.each do |possible_answer_rate|
            - answer_rate = (possible_answer_rate[:answer_rate] * 100).to_f.round
            - width = [answer_rate, 0.1].max
            .answer{ style: 'margin: 40px 0;' }
              .answer-content{ style: 'color: #767676; margin-left: 10px; margin-bottom: 5px;'}= possible_answer_rate[:possible_answer].content
              .progress-custom{ style: 'height: 50px;'}
                %table{style: "width: 100%"}
                  %tr{style: "width: 100%; height: 50px;"}
                    %td{style: "width: #{width}%; background-color: #6086C1; box-shadow: none; border-bottom-right-radius:4px; border-top-right-radius: 4px; color: #FFFFFF; padding: 3px 10px 3px 10px; text-align: right; min-width: max-content; vertical-align: middle", valign: 'middle'}
                      = number_with_delimiter(possible_answer_rate[:answers_count])
                    %td{ style: "color: #5B5B5B; padding: 3px 3px 3px 10px; vertical-align: middle", valign: 'middle'}
                      = "#{answer_rate}%"

  / TODO: move these vars to mailer
  - report_page_url = @from && @to ? report_survey_url(@reportee.id, from: @from.strftime('%Y-%m-%d'), to: @to.strftime('%Y-%m-%d')) : report_survey_url(@reportee.id)
  - scheduled_report_page_url = @scheduled_report_id ? edit_scheduled_report_url(@scheduled_report_id) : nil

  = render 'report_links', report_page_url: report_page_url, report_url: @report_url, report_csv_url: @report_csv_url, scheduled_report_page_url: scheduled_report_page_url
  = render 'footer'
